# 抽奖业务（难度：⭐️⭐️⭐️⭐️⭐️）

## 1、前置知识

**相关文档：**

**《接口文档.xlsx》**

**《设计文档》 第2.2.4章节**

**《设计文档》 第3.2、3.3章节**

**《抽奖业务设计》相关视频**

链接: https://pan.baidu.com/s/1EQFu9q--k2VkanjhPZaiNg?pwd=93ar 



**注意事项：**

本接口是并发度最高的一个点

设计与编码最好做到只与Redis打交道，而不与Mysql交互



**中奖后的处理：**

异步化，交给消息队列



**小提示：**

抽奖流程里的（取令牌-判断-放回令牌）已经写好了lua脚本：tokenCheck.lua，api模块下有个LuaScript，可以协助完成Redis里Lua脚本的调用

返回值：0=奖池已空，1=有令牌但未中奖，其他=已中奖，直接返回的抽中的令牌

可以用返回的令牌去redis里找vlue拿真实的奖品



RabbitMq传输对象的时候，可以使用FastJson将对象转为字符串后传输，可以避免很多问题

接收到消息后，再转回对应对象。



## 2、任务清单

抽奖业务逻辑

中奖后的异步消息处理





## 3、完成标准

### 3.1 完成基础代码编写

完成抽奖接口并提交git：

![image-20231226下午33934162](pic//image-20231226%E4%B8%8B%E5%8D%8833934162.png)



完成中奖后异步消息消费端代码：

<img src="pic//image-20231127%E4%B8%8B%E5%8D%8840538728.png" alt="image-20231127下午40538728" style="zoom:50%;" />

### 3.2 完成代码自测

 【提交接口自测通过的截图】

![image-20231127下午40701625](pic//image-20231127%E4%B8%8B%E5%8D%8840701625.png)



### 3.3 前后端联调

【提交前端抽奖成功的截图】：

<img src="pic//image-20231127%E4%B8%8B%E5%8D%8840759390.png" alt="image-20231127下午40759390" style="zoom:50%;" />



【提交个人中心-中奖记录的截图】：

<img src="pic//image-20231127%E4%B8%8B%E5%8D%8840856361.png" alt="image-20231127下午40856361" style="zoom:50%;" />
