# 关键接口压测（难度：⭐️⭐️⭐️）

## 1、前置知识

**压测工具：**

jmeter安装与使用，本次使用版本：5.6.2

https://jmeter.apache.org/



**压测内容：**

主要给并发最高的抽奖接口打压，要注意需要登录

打压前提前创建好活动，并且处于已开始状态



## 2、任务清单

完成jmeter工具的安装和基本使用

完成抽奖接口压测，提交自己本机的压测结果数据

覆盖以下压测结果：

100个用户，每个用户1000次

100个用户，每个用户10000次

1000个用户，每个用户1000次

1000个用户，每个用户10000次



## 3、完成标准

### 3.1 完成jmeter配置

定义变量：压测的主机、端口、活动id，Value要配置成你要压测的机器的

![image-20231130下午20704555](pic//image-20231130%E4%B8%8B%E5%8D%8820704555.png)

定义线程组：模拟100个用户

![image-20231130下午20549706](pic//image-20231130%E4%B8%8B%E5%8D%8820549706.png)

添加cookie控制器：不然后续抽奖无法获取登录的cookie会提示未登录

![image-20231130下午20801875](pic//image-20231130%E4%B8%8B%E5%8D%8820801875.png)

登录接口：照着配置即可

![image-20231130下午20930729](pic//image-20231130%E4%B8%8B%E5%8D%8820930729.png)

加个循环控制器，里面放上抽奖接口

![image-20231130下午21025106](pic//image-20231130%E4%B8%8B%E5%8D%8821025106.png)

在循环控制器内部添加抽奖接口：

![image-20231130下午21102725](pic//image-20231130%E4%B8%8B%E5%8D%8821102725.png)

添加结果树和聚合报告：用于压测结果的查看和收集

![image-20231130下午21158525](pic//image-20231130%E4%B8%8B%E5%8D%8821158525.png)





### 3.2 提交压测结果参与pk

 【需要提交截图】

![image-20231130下午120005512](pic//image-20231130%E4%B8%8B%E5%8D%88120005512.png)



备注：以下使用测试环境的机器，1台阿里云的公网主机作为例子来分析



样本数据：

模拟了100个人登录，每个人登录后狂点1000次，总抽奖次数10w，加登录的100个请求，共10w零100



下面我们忽略登录这个操作，重点看需要超高并发的抽奖接口：

平均响应时间45ms

50%的请求 <= 42ms

90%的请求 <= 55ms

95%的请求 <= 62ms

99%的请求 <= 95ms

结论：99%的人不到100ms。



最小29ms，最大781ms，考虑99%的人在100ms以内，可以猜测有少量请求网络波动或并发阻塞造成时间超长

平均值大于中位数，说明随请求数增多响应时长的增速变快，呈曲线向上弯曲



无错误请求，全部正确响应



QPS 1814，吞吐量ok，也就意味着这100个人每秒点击屏幕能支持到18.4次，一般人没这个手速

作弊器除外，针对屏幕作弊器可以在Nginx层做ip限流到正常人的点击速度范围内。

